<% if (!ajax) { %>
<html>
<head>
  <title>Rock paper scissors game <%=gameid%></title>
     <script src="/socket.io/socket.io.js"></script> 
     <script type='text/javascript'>

	   function attachevents() {
	   console.log('(re)atacching events');
	   var sels = document.getElementsByClassName('sel');
	   for (var i=0;i<sels.length;i++)
	       {
		   sels[i].addEventListener('click',function(ev) {
			   var selval = ev.target.value;
			   console.log('sending val=%o',selval);
			   socket.send(JSON.stringify({'op':'selval','val':selval}));
		       },false);
	       }
       }

    var gameid = "<%=gameid%>";
var socket = new io.Socket(null,{port:8124,rememberTransport:true,timeout:1500,resource:'socket.io'});
socket.connect();
socket.on('connect', function(){ 
    console.log('connected'); 
    socket.send(JSON.stringify({'op':'connect','gameid':gameid,'rawcookie':document.cookie}));
}) ;
socket.on('message', function(m){ 
    //console.log('got message, %o',m); 

    var gd = document.getElementById('gamediv');
    console.log('changing game'); // %o',m);
    gd.innerHTML = m;
    attachevents();
}) ;
socket.on('disconnect', function(){ console.log('disconnected; reconnecting!'); socket.connect();  });

     </script>
</head>
<body>
[<a href="/">home</a> | <a href="/<%=gameid%>">game link</a>] <br />
  <h3>Rock paper scissors game <%=gameid%></h3>

    <div id='gamediv'>
<% } %>


    <p>you are <i style='color:red'><%=role%></i>. <%=(role=='spectator'?'':(oponent_moved?'Oponent has moved. ':'Oponent has not moved.'))%>
<% var plnames = ['player1','player2','player3'];
for (var i=0;i<plnames.length;i++) { 
    var plname = plnames[i];
    if (presence[plname]) { %> <%=plname%> present. <% }
} %>
<hr />

  <% for (var i=0;i<options.length;i++) { 
     var opt = options[i];
     %>
     <input type='radio' name='mysel' class='sel' value="<%=opt%>" <%=(mysel==opt?' checked=1':'')%>/> <%=opt%><br />
     <% } %>

     <% if (outcome) { %>
     <h3>Game over: <%=outcome%></h3>
     <% } %>


<% if (!ajax) { %>
</div>

<script type='text/javascript'>
	  attachevents();
</script>
<!--GAMEDIVPLACEHOLDER-->
</body>
</html>
<% } %>